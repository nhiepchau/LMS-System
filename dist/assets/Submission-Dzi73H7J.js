import{_ as q}from"./FileInput.vue_vue_type_script_setup_true_lang-CaJ66iyW.js";import{d as B,b8 as F,K as z,r as u,ak as A,a as x,f as j,w as t,b as e,q as T,l as i,j as P,g as C,m as O,s as D,t as N,u as S,c as $,N as E,z as G,A as H,B as V,C as K,L,o as M,G as R,H as J,v as Q,F as W,h as U,I as X}from"./index-CD3Z2ZO-.js";import{u as Y}from"./course-B5M-fkkV.js";import{V as Z}from"./VDataTableServer-SWvNUp56.js";import"./VDataTable-Cx5vP7nG.js";const ee={class:"d-flex flex-row text-primary mb-2"},se=i("h2",{class:"my-auto"},"Import new file",-1),te={class:"mt-4"},ae={class:"border-sm rounded pa-4 my-4 mx-auto",style:{height:"250px"}},oe={class:"d-flex flex-row text-primary"},ie=i("h3",null,"Submission file",-1),ne={key:0,class:"mt-15"},le={key:1,class:"text-center mt-10"},re=B({__name:"UploadSubmission",props:{classId:{type:Number,required:!0}},emits:["openSubmissionCard"],setup(I,{emit:k}){const d=k,g=I,m=F(),b=z(),n=u(),l=u(!1),v=A("create-notification"),y="http://127.0.0.1:8000";async function h(){if(n.value){const c=new FormData;c.append("submission_file",n.value),c.append("class_code",`${g.classId}`),console.log("FormData ",c),l.value=!0,await L.post(`${y}/api/classes/${m.params.class_code}/submissions/upload`,c,{headers:{Authorization:`Bearer ${b.token}`,"Content-Type":"multipart/form-data"}}).then(function(r){var f;l.value=!1,d("openSubmissionCard",!1),v({type:"success",message:`Sent file ${(f=n.value)==null?void 0:f.name} successfully! Please wait few minutes for processing and analyzing data!`})}).catch(function(){l.value=!1,d("openSubmissionCard",!1),v({type:"error",message:"Something's wrong when uploading!"})})}}return(c,r)=>{const f=q;return x(),j(K,{class:"w-66 mx-auto text-secondary"},{default:t(()=>[e(T,null,{default:t(()=>[i("div",ee,[se,e(P,{size:"md",class:"ml-2 my-auto"},{default:t(()=>[C("fas fa-chevron-right")]),_:1}),e(O,{class:"ml-4 my-auto"},{default:t(()=>[C("Submissions")]),_:1})]),e(D),i("p",te,"Please import more submission data for the class "+N(S(m).params.class_code.toString().substring(6)),1),i("div",ae,[i("div",oe,[e(P,{class:"mr-2"},{default:t(()=>[C("fas fa-file-alt")]),_:1}),ie]),l.value?(x(),$("div",le,[e(E,{size:100,width:7,color:"primary",indeterminate:""})])):(x(),$("div",ne,[e(f,{idx:0,type:"Submission",onUploadFile:r[0]||(r[0]=a=>n.value=a)})]))])]),_:1}),e(D,{class:"my-1"}),e(G,null,{default:t(()=>[e(H),e(V,{text:"Close",class:"text-none bg-blue-lighten-5 text-blue-darken-2",onClick:r[1]||(r[1]=a=>d("openSubmissionCard",!1)),disabled:l.value},null,8,["disabled"]),e(V,{class:"text-none bg-primary",text:"Save",onClick:h,disabled:l.value},null,8,["disabled"])]),_:1})]),_:1})}}}),ue={class:"d-flex flex-row w-100 justify-space-between"},de={class:"text-primary"},be=B({__name:"Submission",setup(I){const k=F(),d=u(!1),g=u(0),m=k.params.class_code.toString(),b=u(25),n=u(!1),l=Y();async function v(){const a=m.substring(6,12),{data:s}=await U.get(`/api/courses/${a}/classes/${m}`);g.value=s.pk,y.value=s.num_of_submissions}const y=u(0),h=u();async function c({page:a,itemsPerPage:s,sortBy:p}){n.value=!0,await r(a,s,p),n.value=!1}async function r(a,s,p){const w=p.length>0?`&sortBy=${p[0].key}&sortOrder=${p[0].order}`:"",{data:o}=await U.get(`/api/classes/${m}/submissions?page=${a}&items=${s}${w}`);h.value=o.map(_=>({question_id:_.exercise,secured_student_id:_.student,started_time:_.started_time,submitted_time:_.submitted_time,time_taken:_.time_taken,score:_.score}))}M(async()=>{await v(),await r(1,b.value,[])});const f=[{title:"question_id",align:"start",key:"question_id",sortable:!1},{title:"secured_student_id",align:"start",key:"secured_student_id",sortable:!1},{title:"started_time",align:"start",key:"started_time",sortable:!0},{title:"submitted_time",align:"start",key:"submitted_time",sortable:!0},{title:"time_taken",align:"start",key:"time_taken",sortable:!1},{title:"score",align:"center",key:"score",sortable:!0}];return(a,s)=>{const p=X,w=re;return x(),$(W,null,[e(p),e(Q,null,{default:t(()=>[i("div",ue,[i("h1",de," ["+N(S(m).substring(6))+"] Submissions ",1),i("div",null,[e(R,{modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=o=>d.value=o)},{activator:t(({props:o})=>[e(V,J({onClick:s[0]||(s[0]=_=>S(l).resetCourse()),variant:"flat"},o,{class:"text-none bg-primary text-white","prepend-icon":"fas fa-file-upload"}),{default:t(()=>[C("Import")]),_:2},1040)]),default:t(()=>[e(w,{classId:g.value,onOpenSubmissionCard:s[1]||(s[1]=o=>{d.value=o})},null,8,["classId"])]),_:1},8,["modelValue"])])]),e(Z,{class:"border-sm rounded-lg mt-8","items-per-page":b.value,"onUpdate:itemsPerPage":s[3]||(s[3]=o=>b.value=o),items:h.value,headers:f,"items-length":y.value,loading:n.value,"item-value":"name","show-select":"","onUpdate:options":c},null,8,["items-per-page","items","items-length","loading"])]),_:1})],64)}}});export{be as default};
