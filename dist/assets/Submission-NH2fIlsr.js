import{_ as z}from"./FileInput.vue_vue_type_script_setup_true_lang-Bk4-HZcW.js";import{d as B,b7 as F,J as N,r as u,aj as j,a as x,f as A,w as t,b as e,q as T,l as i,j as P,g as C,m as M,s as D,t as q,u as S,c as V,M as O,z as E,A as G,B as $,C as H,K as J,o as K,G as R,v as L,F as Q,h as U,H as W}from"./index-BFMTCsx2.js";import{u as X}from"./course-B4AiQFDZ.js";import{V as Y}from"./VDialog-DOtGhtWv.js";import{V as Z}from"./VDataTableServer-DypQq9Kd.js";import"./VDataTable-CqR1q49H.js";const ee={class:"d-flex flex-row text-primary mb-2"},se=i("h2",{class:"my-auto"},"Import new file",-1),te={class:"mt-4"},ae={class:"border-sm rounded pa-4 my-4 mx-auto",style:{height:"250px"}},oe={class:"d-flex flex-row text-primary"},ie=i("h3",null,"Submission file",-1),ne={key:0,class:"mt-15"},le={key:1,class:"text-center mt-10"},re=B({__name:"UploadSubmission",props:{classId:{type:Number,required:!0}},emits:["openSubmissionCard"],setup(I,{emit:w}){const d=w,g=I,m=F(),b=N(),n=u(),l=u(!1),v=j("create-notification"),y="http://127.0.0.1:8000";async function h(){if(n.value){const c=new FormData;c.append("submission_file",n.value),c.append("class_code",`${g.classId}`),console.log("FormData ",c),l.value=!0,await J.post(`${y}/api/classes/${m.params.class_code}/submissions/upload`,c,{headers:{Authorization:`Bearer ${b.token}`,"Content-Type":"multipart/form-data"}}).then(function(r){var f;l.value=!1,d("openSubmissionCard",!1),v({type:"success",message:`Sent file ${(f=n.value)==null?void 0:f.name} successfully! Please wait few minutes for processing and analyzing data!`})}).catch(function(){l.value=!1,d("openSubmissionCard",!1),v({type:"error",message:"Something's wrong when uploading!"})})}}return(c,r)=>{const f=z;return x(),A(H,{class:"w-66 mx-auto text-secondary"},{default:t(()=>[e(T,null,{default:t(()=>[i("div",ee,[se,e(P,{size:"md",class:"ml-2 my-auto"},{default:t(()=>[C("fas fa-chevron-right")]),_:1}),e(M,{class:"ml-4 my-auto"},{default:t(()=>[C("Submissions")]),_:1})]),e(D),i("p",te,"Please import more submission data for the class "+q(S(m).params.class_code.toString().substring(6)),1),i("div",ae,[i("div",oe,[e(P,{class:"mr-2"},{default:t(()=>[C("fas fa-file-alt")]),_:1}),ie]),l.value?(x(),V("div",le,[e(O,{size:100,width:7,color:"primary",indeterminate:""})])):(x(),V("div",ne,[e(f,{idx:0,type:"Submission",onUploadFile:r[0]||(r[0]=a=>n.value=a)})]))])]),_:1}),e(D,{class:"my-1"}),e(E,null,{default:t(()=>[e(G),e($,{text:"Close",class:"text-none bg-blue-lighten-5 text-blue-darken-2",onClick:r[1]||(r[1]=a=>d("openSubmissionCard",!1)),disabled:l.value},null,8,["disabled"]),e($,{class:"text-none bg-primary",text:"Save",onClick:h,disabled:l.value},null,8,["disabled"])]),_:1})]),_:1})}}}),ue={class:"d-flex flex-row w-100 justify-space-between"},de={class:"text-primary"},ge=B({__name:"Submission",setup(I){const w=F(),d=u(!1),g=u(0),m=w.params.class_code.toString(),b=u(25),n=u(!1),l=X();async function v(){const a=m.substring(6,12),{data:s}=await U.get(`/api/courses/${a}/classes/${m}`);g.value=s.pk,y.value=s.num_of_submissions}const y=u(0),h=u();async function c({page:a,itemsPerPage:s,sortBy:p}){n.value=!0,await r(a,s,p),n.value=!1}async function r(a,s,p){const k=p.length>0?`&sortBy=${p[0].key}&sortOrder=${p[0].order}`:"",{data:o}=await U.get(`/api/classes/${m}/submissions?page=${a}&items=${s}${k}`);h.value=o.map(_=>({question_id:_.exercise,secured_student_id:_.student,started_time:_.started_time,submitted_time:_.submitted_time,time_taken:_.time_taken,score:_.score}))}K(async()=>{await v(),await r(1,b.value,[])});const f=[{title:"question_id",align:"start",key:"question_id",sortable:!1},{title:"secured_student_id",align:"start",key:"secured_student_id",sortable:!1},{title:"started_time",align:"start",key:"started_time",sortable:!0},{title:"submitted_time",align:"start",key:"submitted_time",sortable:!0},{title:"time_taken",align:"start",key:"time_taken",sortable:!1},{title:"score",align:"center",key:"score",sortable:!0}];return(a,s)=>{const p=W,k=re;return x(),V(Q,null,[e(p),e(L,null,{default:t(()=>[i("div",ue,[i("h1",de," ["+q(S(m).substring(6))+"] Submissions ",1),i("div",null,[e(Y,{modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=o=>d.value=o)},{activator:t(({props:o})=>[e($,R({onClick:s[0]||(s[0]=_=>S(l).resetCourse()),variant:"flat"},o,{class:"text-none bg-primary text-white","prepend-icon":"fas fa-file-upload"}),{default:t(()=>[C("Import")]),_:2},1040)]),default:t(()=>[e(k,{classId:g.value,onOpenSubmissionCard:s[1]||(s[1]=o=>{d.value=o})},null,8,["classId"])]),_:1},8,["modelValue"])])]),e(Z,{class:"border-sm rounded-lg mt-8","items-per-page":b.value,"onUpdate:itemsPerPage":s[3]||(s[3]=o=>b.value=o),items:h.value,headers:f,"items-length":y.value,loading:n.value,"item-value":"name","show-select":"","onUpdate:options":c},null,8,["items-per-page","items","items-length","loading"])]),_:1})],64)}}});export{ge as default};
