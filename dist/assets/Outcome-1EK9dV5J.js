import{d as z,b4 as K,bd as Q,be as W,bz as X,bA as Y,bb as ee,b5 as te,b6 as ae,y as se,a1 as B,r as f,h as U,a as k,k as N,e as g,b as n,w as v,c as R,i as M,t as P,P as H,b9 as w,H as j,bB as le,v as ne,F as Z,V as oe,f as G,g as q,j as T,n as re,p as ue,q as J,s as de,o as ie,m as me,u as ce,x as pe,b8 as fe,_ as be}from"./index-MoPcLG9q.js";import{V as ve}from"./VDataTableServer-ai8Ctg2N.js";import"./VDataTable-BW5uJkcr.js";import"./VTable-DrOtf772.js";const ge={class:"mt-4 d-flex flex-row w-100 justify-space-between"},_e={class:"w-33 d-flex flex-row"},ye={key:1,class:"text-dark-grey text-sm-caption align-self-center"},Ce={class:"d-flex flex-row"},he=z({__name:"StudentProgressChart",props:{studentId:{type:Number,default:0},classCode:{type:String,default:""},numOfLab:{type:Number,default:0},startLab:{type:String,default:""},endLab:{type:String,default:""}},setup(O){K.register(Q,W,X,Y,ee,te,ae);const C=O,d=se({chartData:{labels:[],datasets:[{label:"",backgroundColor:"",data:[]}]},filterChartData:{labels:[],datasets:[{label:"",backgroundColor:"",data:[]}]}}),b=B(()=>d.filterChartData),i=f(C.startLab),c=f(C.endLab),p=f([]),_=f([]);function h(){const o=Array.from({length:C.numOfLab},(l,s)=>s+1).map(l=>l);let e=[];return o.forEach(l=>{e.push(`${l}-pre`),e.push(`${l}-in`),e.push(`${l}-post`)}),e}function D(){let o=h();const e=o.findIndex(s=>s===i.value),l=o.findIndex(s=>s==c.value);return e>l&&(c.value=o.at(e)??""),o.slice(e,l+1)}const $=B(()=>{let o=h();const e=o.findIndex(s=>s===i.value),l=o.findIndex(s=>s==c.value);return e>l&&(c.value=o.at(e)??""),i.value&&c.value&&I(),o.slice(e)});function F(o,e){return(""+o).localeCompare(e)}const V=[{primary:"#4EA699",sub:"#D3FFD3"},{primary:"#6F9CEB",sub:"#D3E1FF"},{primary:"#E15358",sub:"#FFD3D3"},{primary:"#FF7818",sub:"#FFD2B2"},{primary:"#663A82",sub:"#BCA0DC"},{primary:"#4F4F4F",sub:"#BABABA"}];async function I(){await U.get(`/api/classes/${C.classCode}/students/${C.studentId}/from/${i.value}/to/${c.value}/progress`).then(function(o){const{data:e}=o;_.value=Object.keys(e).filter(s=>s.toString().includes("L.O")&&!s.toString().includes("max")).sort(F),p.value.length<=0&&(p.value=_.value.filter((s,y)=>y<2));let l=_.value.map((s,y)=>({label:s,backgroundColor:V[y].primary,borderColor:V[y].primary,data:e[s].map(r=>r*100)}));l.push(..._.value.map((s,y)=>({label:`max_${s}`,backgroundColor:V[y].sub,borderColor:V[y].sub,data:e[`max_${s}`].map(r=>r*100)}))),d.chartData={labels:D(),datasets:l},E()})}function E(){let o=p.value.map(e=>e);o.push(...p.value.map(e=>`max_${e}`)),d.filterChartData={labels:d.chartData.labels,datasets:d.chartData.datasets.filter(e=>o.filter(l=>l==e.label).length>0)}}const A={responsive:!0,maintainAspectRatio:!0,indexAxis:"x",scales:{y:{beginAtZero:!0}}};return(o,e)=>(k(),N(Z,null,[g("div",ge,[g("div",_e,[n(w,{label:"Outcomes",modelValue:p.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>p.value=l),e[1]||(e[1]=()=>E())],items:_.value,variant:"solo","bg-color":"#F3F4F6",flat:"",multiple:"",density:"compact","single-line":""},{selection:v(({item:l,index:s})=>[s<2?(k(),R(M,{key:0,class:"text-sm-caption"},{default:v(()=>[g("span",null,P(l.title),1)]),_:2},1024)):H("",!0),s===2?(k(),N("span",ye," (+"+P(p.value.length-2)+" others) ",1)):H("",!0)]),_:1},8,["modelValue","items"])]),g("div",Ce,[n(w,{label:"Start lab",modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value=l),items:h(),variant:"solo",density:"compact",class:"mr-2","bg-color":"#F3F4F6",flat:""},null,8,["modelValue","items"]),n(w,{label:"End lab",modelValue:c.value,"onUpdate:modelValue":[e[3]||(e[3]=l=>c.value=l),e[4]||(e[4]=()=>I())],items:$.value,variant:"solo",density:"compact","bg-color":"#F3F4F6",flat:""},null,8,["modelValue","items"])])]),g("div",ne({class:"pa-4 border-sm rounded-lg"},o.$attrs),[n(j(le),{data:b.value,options:A},null,8,["data"])],16)],64))}}),Ve={class:"d-flex flex-row text-primary mb-2"},Le=g("h2",{class:"my-auto"},"Outcome Progress (%)",-1),xe=z({__name:"StudentDetail",props:{studentId:{type:Number,default:0},classCode:{type:String,default:""},numOfLab:{type:Number,default:0},startLab:{type:String,default:""},endLab:{type:String,default:""}},emits:["openDialog"],setup(O,{emit:C}){const d=O,b=C;return(i,c)=>{const p=he;return k(),R(de,{class:"w-66 mx-auto text-secondary"},{default:v(()=>[n(oe,null,{default:v(()=>[g("div",Ve,[Le,n(G,{size:"md",class:"ml-2 my-auto"},{default:v(()=>[q("fas fa-chevron-right")]),_:1}),n(M,{class:"ml-4 my-auto"},{default:v(()=>[q("Student "+P(d.studentId),1)]),_:1})]),n(T),n(p,{studentId:d.studentId,startLab:d.startLab,endLab:d.endLab,numOfLab:d.numOfLab,classCode:d.classCode,class:"mb-4"},null,8,["studentId","startLab","endLab","numOfLab","classCode"])]),_:1}),n(T,{class:"my-1"}),n(re,null,{default:v(()=>[n(ue),n(J,{text:"Close",class:"text-none bg-blue-lighten-5 text-blue-darken-2 mr-4",onClick:c[0]||(c[0]=_=>b("openDialog",!1))})]),_:1})]),_:1})}}}),$e={class:"d-flex flex-row w-100 justify-space-between"},Fe={class:"text-primary"},De={class:"d-flex flex-row w-33"},Oe=z({__name:"Outcome",setup(O){const d=fe().params.class_code.toString(),b=f(""),i=f(""),c=f(!1),p=f(""),_=f(),h=f(),D=f([]),$=f(10),F=f(1),V=f(!1),I=f();async function E(){const r=d.substring(6,12);await U.get(`/api/courses/${r}/classes/${d}`).then(function(t){const{data:u}=t;h.value={num_of_lab:u.num_of_lab,num_of_students:u.num_of_students},b.value="1-pre",i.value="1-post",s(F.value,$.value)})}function A(){var u;const r=Array.from({length:(u=h.value)==null?void 0:u.num_of_lab},(m,L)=>L+1).map(m=>m);let t=[];return r.forEach(m=>{t.push(`${m}-pre`),t.push(`${m}-in`),t.push(`${m}-post`)}),t}const o=B(()=>{let r=A();const t=r.findIndex(m=>m===b.value),u=r.findIndex(m=>m==i.value);return t>u&&(i.value=r.at(t)??""),b.value&&i.value&&s(F.value,$.value),r.slice(t)});async function e({page:r,itemsPerPage:t,sortBy:u}){V.value=!0,b.value&&i.value&&await s(r,t)}function l(r,t){return(""+r).localeCompare(t)}async function s(r,t){const u=p.value&&p.value!==""?`&query=${p.value}`:"";await U.get(`/api/classes/${d}/students/all/from/${b.value}/to/${i.value}/progress?page=${r}&items=${t}${u}`).then(function(m){const{data:L}=m;D.value=L.length>0?Object.keys(L.at(0)).filter(a=>a.toString().includes("L.O")&&!a.toString().includes("max")).sort(l):[],I.value=L.map(a=>{let x={};return x.student=a.student,x.first_name=a.first_name,x.last_name=a.last_name,x.secured_student=a.secured_student,D.value.forEach(S=>{x[S]={start:a[S][0],end:a[S][1],max_start:a[`max_${S}`][0],max_end:a[`max_${S}`][1]}}),x}),V.value=!1})}const y=B(()=>{const r=D.value.map(u=>({title:u,align:"center",sortable:!1,key:u,value:m=>`${m[u].start} / ${m[u].end}`})),t=[{title:"student_id",align:"start",key:"student",sortable:!1},{title:"first_name",align:"start",key:"first_name",sortable:!1},{title:"last_name",align:"start",key:"last_name",sortable:!1},{title:"secured_student_id",align:"start",key:"secured_student",sortable:!1}];return t.push(...r),t.push({title:"progress",align:"center",key:"progress",sortable:!1,value:u=>u.student}),t});return ie(async()=>{await E()}),(r,t)=>{const u=be,m=xe;return k(),N(Z,null,[n(u),n(pe,null,{default:v(()=>{var L;return[g("div",$e,[g("h1",Fe," ["+P(j(d).substring(6))+"] Learning Outcomes ",1),g("div",De,[n(w,{label:"Start lab",modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a),items:A(),variant:"solo",density:"compact",class:"mr-2","bg-color":"#F3F4F6",flat:""},null,8,["modelValue","items"]),n(w,{label:"End lab",modelValue:i.value,"onUpdate:modelValue":[t[1]||(t[1]=a=>i.value=a),t[2]||(t[2]=()=>s(F.value,$.value))],items:o.value,variant:"solo",density:"compact","bg-color":"#F3F4F6",flat:""},null,8,["modelValue","items"])])]),g("div",null,[n(me,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=a=>p.value=a),variant:"outlined",color:"dark-grey",class:"w-50",density:"compact",placeholder:"Search student id...","hide-details":""},null,8,["modelValue"])]),n(ve,{class:"border-sm rounded-lg mt-2",page:F.value,"onUpdate:page":t[4]||(t[4]=a=>F.value=a),"items-per-page":$.value,"onUpdate:itemsPerPage":t[5]||(t[5]=a=>$.value=a),items:I.value,headers:y.value,"items-length":((L=h.value)==null?void 0:L.num_of_students)??0,loading:V.value,"item-value":"name","onUpdate:options":e},{"item.progress":v(({value:a})=>[n(J,{icon:"",flat:"",variant:"plain",onClick:()=>{c.value=!0,_.value=a}},{default:v(()=>[n(G,{size:"small",class:"text-sub"},{default:v(()=>[q("fas fa-chart-simple")]),_:1})]),_:2},1032,["onClick"])]),_:1},8,["page","items-per-page","items","headers","items-length","loading"]),n(ce,{modelValue:c.value,"onUpdate:modelValue":t[7]||(t[7]=a=>c.value=a)},{default:v(()=>{var a;return[n(m,{studentId:_.value,startLab:b.value,endLab:i.value,numOfLab:((a=h.value)==null?void 0:a.num_of_lab)??0,classCode:j(d),onOpenDialog:t[6]||(t[6]=x=>c.value=x)},null,8,["studentId","startLab","endLab","numOfLab","classCode"])]}),_:1},8,["modelValue"])]}),_:1})],64)}}});export{Oe as default};
