import{_ as ce}from"./FileInput.vue_vue_type_script_setup_true_lang-BKL-s5zo.js";import{K as me,M as pe,I as C,a8 as h,aP as fe,ab as ge,N as be,g as t,F as M,E as V,d as J,a_ as K,b9 as _e,r as y,aU as ve,o as k,c as ye,w as p,m as he,b as _,i as R,j as D,l as Se,q as z,t as W,J as Q,e as I,ba as xe,x as Pe,y as we,z as $,A as Ve,G as ke,s as De,H as Te}from"./index-Di_eUCWP.js";import{a as Ce,h as A}from"./http-nrUfQssp.js";import{V as Ie}from"./VDialog-DiYHY930.js";import{m as $e,a as Be,b as Fe,c as Ne,d as Ue,e as qe,f as Ee,u as Ge,p as Re,g as ze,h as Ae,i as He,j as je,k as Le,l as Oe,n as H,o as j,q as L}from"./VDataTable-BWLNB8-7.js";import{V as O}from"./VTable-DqcBnfAS.js";const Me=me({itemsLength:{type:[Number,String],required:!0},...$e(),...Be(),...Fe()},"VDataTableServer"),Je=pe()({name:"VDataTableServer",props:Me(),emits:{"update:modelValue":a=>!0,"update:page":a=>!0,"update:itemsPerPage":a=>!0,"update:sortBy":a=>!0,"update:options":a=>!0,"update:expanded":a=>!0,"update:groupBy":a=>!0},setup(a,x){let{attrs:f,slots:e}=x;const{groupBy:l}=Ne(a),{sortBy:n,multiSort:r,mustSort:u}=Ue(a),{page:d,itemsPerPage:v}=qe(a),P=C(()=>parseInt(a.itemsLength,10)),{columns:i,headers:g}=Ee(a,{groupBy:l,showSelect:h(a,"showSelect"),showExpand:h(a,"showExpand")}),{items:o}=Ge(a,i),{toggleSort:s}=Re({sortBy:n,multiSort:r,mustSort:u,page:d}),{opened:S,isGroupOpen:c,toggleGroup:b,extractRows:X}=ze({groupBy:l,sortBy:n}),{pageCount:Y,setItemsPerPage:Z}=Ae({page:d,itemsPerPage:v,itemsLength:P}),{flatItems:B}=He(o,l,S),{isSelected:ee,select:ae,selectAll:te,toggleSelect:se,someSelected:oe,allSelected:le}=je(a,{allItems:o,currentPage:o}),{isExpanded:ne,toggleExpand:ie}=Le(a),F=C(()=>X(o.value));Oe({page:d,itemsPerPage:v,sortBy:n,groupBy:l,search:h(a,"search")}),fe("v-data-table",{toggleSort:s,sortBy:n}),ge({VDataTableRows:{hideNoData:h(a,"hideNoData"),noDataText:h(a,"noDataText"),loading:h(a,"loading"),loadingText:h(a,"loadingText")}});const m=C(()=>({page:d.value,itemsPerPage:v.value,sortBy:n.value,pageCount:Y.value,toggleSort:s,setItemsPerPage:Z,someSelected:oe.value,allSelected:le.value,isSelected:ee,select:ae,selectAll:te,toggleSelect:se,isExpanded:ne,toggleExpand:ie,isGroupOpen:c,toggleGroup:b,items:F.value.map(T=>T.raw),internalItems:F.value,groupedItems:B.value,columns:i.value,headers:g.value}));be(()=>{const T=H.filterProps(a),re=j.filterProps(a),ue=L.filterProps(a),de=O.filterProps(a);return t(O,V({class:["v-data-table",{"v-data-table--loading":a.loading},a.class],style:a.style},de),{top:()=>{var w;return(w=e.top)==null?void 0:w.call(e,m.value)},default:()=>{var w,N,U,q,E,G;return e.default?e.default(m.value):t(M,null,[(w=e.colgroup)==null?void 0:w.call(e,m.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(j,V(re,{sticky:a.fixedHeader}),e)]),(N=e.thead)==null?void 0:N.call(e,m.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(U=e["body.prepend"])==null?void 0:U.call(e,m.value),e.body?e.body(m.value):t(L,V(f,ue,{items:B.value}),e),(q=e["body.append"])==null?void 0:q.call(e,m.value)]),(E=e.tbody)==null?void 0:E.call(e,m.value),(G=e.tfoot)==null?void 0:G.call(e,m.value)])},bottom:()=>e.bottom?e.bottom(m.value):t(H,T,{prepend:e["footer.prepend"]})})})}}),Ke={class:"d-flex flex-row text-primary mb-2"},We=_("h2",{class:"my-auto"},"Import new file",-1),Qe={class:"mt-4"},Xe={class:"border-sm rounded pa-4 my-4 mx-auto",style:{height:"250px"}},Ye={class:"d-flex flex-row text-primary"},Ze=_("h3",null,"Submission file",-1),ea={key:0,class:"mt-15"},aa={key:1,class:"text-center mt-10"},ta=J({__name:"UploadSubmission",props:{classId:{type:Number,required:!0}},emits:["openSubmissionCard"],setup(a,{emit:x}){const f=x,e=a,l=K(),n=_e(),r=y(),u=y(!1),d=ve("create-notification"),v="http://127.0.0.1:8000";async function P(){if(r.value){const i=new FormData;i.append("submission_file",r.value),i.append("class_code",`${e.classId}`),console.log("FormData ",i),u.value=!0,await Ce.post(`${v}/api/classes/${l.params.class_code}/submissions/upload`,i,{headers:{Authorization:`Bearer ${n.token}`,"Content-Type":"multipart/form-data"}}).then(function(g){var o;u.value=!1,f("openSubmissionCard",!1),d({type:"success",message:`Sent file ${(o=r.value)==null?void 0:o.name} successfully! Please wait few minutes for processing and analyzing data!`})}).catch(function(){u.value=!1,f("openSubmissionCard",!1),d({type:"error",message:"Something's wrong when uploading!"})})}}return(i,g)=>{const o=ce;return k(),ye(Ve,{class:"w-66 mx-auto text-secondary"},{default:p(()=>[t(he,null,{default:p(()=>[_("div",Ke,[We,t(R,{size:"md",class:"ml-2 my-auto"},{default:p(()=>[D("fas fa-chevron-right")]),_:1}),t(Se,{class:"ml-4 my-auto"},{default:p(()=>[D("Submissions")]),_:1})]),t(z),_("p",Qe,"Please import more submission data for the class "+W(Q(l).params.class_code.toString().substring(6)),1),_("div",Xe,[_("div",Ye,[t(R,{class:"mr-2"},{default:p(()=>[D("fas fa-file-alt")]),_:1}),Ze]),u.value?(k(),I("div",aa,[t(xe,{size:100,width:7,color:"primary",indeterminate:""})])):(k(),I("div",ea,[t(o,{idx:0,type:"Submission",onUploadFile:g[0]||(g[0]=s=>r.value=s)})]))])]),_:1}),t(z,{class:"my-1"}),t(Pe,null,{default:p(()=>[t(we),t($,{text:"Close",class:"text-none bg-blue-lighten-5 text-blue-darken-2",onClick:g[1]||(g[1]=s=>f("openSubmissionCard",!1)),disabled:u.value},null,8,["disabled"]),t($,{class:"text-none bg-primary",text:"Save",onClick:P,disabled:u.value},null,8,["disabled"])]),_:1})]),_:1})}}}),sa={class:"d-flex flex-row w-100 justify-space-between"},oa={class:"text-primary"},ca=J({__name:"Submission",setup(a){const x=K(),f=y(!1),e=y(0),l=x.params.class_code.toString(),n=y(25),r=y(!1);async function u(){const o=l.substring(6,12),{data:s}=await A.get(`/api/courses/${o}/classes/${l}`);e.value=s.pk,d.value=s.num_of_submissions}const d=y(0),v=y();async function P({page:o,itemsPerPage:s,sortBy:S}){r.value=!0,await i(o,s),r.value=!1}async function i(o,s){const{data:S}=await A.get(`/api/classes/${l}/submissions?page=${o}&items=${s}`);v.value=S.map(c=>({question_id:c.exercise,secured_student_id:c.student,started_time:c.started_time,submitted_time:c.submitted_time,time_taken:c.time_taken,score:c.score}))}ke(async()=>{await u(),await i(1,n.value)});const g=[{title:"question_id",align:"start",key:"question_id",sortable:!1},{title:"secured_student_id",align:"start",key:"secured_student_id",sortable:!1},{title:"started_time",align:"start",key:"started_time",sortable:!1},{title:"submitted_time",align:"start",key:"submitted_time",sortable:!1},{title:"time_taken",align:"start",key:"time_taken",sortable:!1},{title:"score",align:"center",key:"score",sortable:!1}];return(o,s)=>{const S=Te,c=ta;return k(),I(M,null,[t(S),t(De,null,{default:p(()=>[_("div",sa,[_("h1",oa," ["+W(Q(l).substring(6))+"] Submissions ",1),_("div",null,[t(Ie,{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=b=>f.value=b)},{activator:p(({props:b})=>[t($,V({variant:"flat"},b,{class:"text-none bg-primary text-white","prepend-icon":"fas fa-file-upload"}),{default:p(()=>[D("Import")]),_:2},1040)]),default:p(()=>[t(c,{classId:e.value,onOpenSubmissionCard:s[0]||(s[0]=b=>{f.value=b})},null,8,["classId"])]),_:1},8,["modelValue"])])]),t(Je,{class:"border-sm rounded-lg mt-8","items-per-page":n.value,"onUpdate:itemsPerPage":s[2]||(s[2]=b=>n.value=b),items:v.value,headers:g,"items-length":d.value,loading:r.value,"item-value":"name","show-select":"","onUpdate:options":P},null,8,["items-per-page","items","items-length","loading"])]),_:1})],64)}}});export{ca as default};
